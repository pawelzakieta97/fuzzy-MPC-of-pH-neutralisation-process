addpath('./membership_functions/');
addpath('../');

op_points = [2.96, 4.76, 6.7, 8.19, 10];
% op_points = [8.5];
D = 80;
N = D;
Nu = 40;
lambda_init = [0.1, 1, 0.05, 0.1, 0.1];
lambda_init = [0.2, 0.5, 0.1, 0.1, 0.1];
lambda_init = [0.1, 1, 0.1, 1, 0.1];
% lambda_init = [0.1, 0.1, 0.1, 0.1, 0.1];
% lambda_init = [0.01, 0.1, 0.02, 1, 0.1];
% lambda_init = [1];
%lambda_init = [0.1, 1, 0.2, 10, 1];
step_size = 0.1;

[fc, fm] = get_fuzzy_controller(op_points, lambda_init, step_size, @normal, Nu, 1);
fc.numeric = false;
fc.set_sigmas([0.6,0.6,0.6,0.6,0.6]);
fc.main_model.set_sigmas([0.6,0.6,0.6,0.6,0.6]);
fm.set_sigmas([0.5,1,0.5,1,0.5]);
% fc.set_sigmas([1.1,0.38,1.2,0.43,1.53]);
fc.update_lambdas([1, 0.5, 1, 0.2, 1]);
% fc.update_lambdas([0.1, 0.1, 0.1, 0.1, 0.1]);
Ysp = generate_setpoint();
% fm.set_sigmas(1);
range = [op_points(1)-0.1, op_points(1)+0.1];
%Ysp = random_signal(500, 100, range, 1);
model1_a = simulation(fc, Ysp,1);
%model1_a.plot();
% model1_a.save_csv(['../wykresy/ph/',folder_name,'/analityczny.csv']);
fm.verify(model1_a,1);

% fc.reset();
% fc.numeric = true;
% fc.use_full_steering = true;
% fc.predict_lambdas = 0;
% fc.iterations = 1;
% fc.sim_model = fm;
% model1_slrn_fm = simulation(fc, Ysp,1);
% model1_slrn_fm.plot();
% model1_slrn_fm.save_csv(['../wykresy/ph/',folder_name,'/slrnfm.csv']);
